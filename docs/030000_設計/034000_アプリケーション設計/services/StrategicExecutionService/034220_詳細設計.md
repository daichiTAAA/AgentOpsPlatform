---
title: StrategicExecutionService 詳細設計
version: "0.1"
status: draft
owner: システム開発チーム
updated: 2025-09-07
related_requirements: ["UC-01"]
---

# 034220 詳細設計（StrategicExecutionService）

## パッケージ構成
```
StrategicExecutionService/
├── controller/          # Redmine連携・リクエスト制御
├── usecase/            # 戦略分析・計画生成ロジック
│   ├── vision_analyzer/     # ビジョン解析・目標分解
│   ├── strategy_generator/  # 戦略計画生成・最適化
│   └── risk_assessor/      # リスク評価・依存関係分析
├── repository/         # Databricks・外部データアクセス
└── domain/            # 戦略・計画・リスクエンティティ
```

## ユースケース別処理フロー

### UC-01-01: ビジョン登録・初期分析
1. **入力検証**: ビジョン・目標の形式・必須項目チェック
2. **過去事例検索**: Databricks Vector Searchで類似戦略・成功パターン検索
3. **目標分解**: AIによる具体的目標・マイルストーン抽出
4. **初期WBS生成**: タスク階層・依存関係の初期構造作成
5. **VS Code配置**: 分析結果を共同編集用ワークスペースに配置
6. **承認依頼**: Redmineに承認フロー開始

### UC-01-02: 人機協調レビュー・計画調整
1. **レビュー通知**: 経営者にRedmine経由で通知
2. **共同編集**: VS Code内で計画書レビュー・修正
3. **Copilot支援**: 過去事例・ベストプラクティスに基づく改善提案
4. **再分析**: 修正内容を踏まえたDatabricksでの再計算
5. **整合性チェック**: 計画全体の論理性・実現可能性検証
6. **承認判断**: 経営者による最終承認・却下・再修正指示

### UC-01-03: 承認後実行・進捗管理
1. **実行開始**: 承認済み計画に基づくタスク作成・割り当て
2. **進捗監視**: 定期的な実行状況・KPI確認
3. **リスク検出**: 遅延・課題・リスク要因の早期発見
4. **調整提案**: 計画変更・リソース再配分の提案
5. **継続的最適化**: 実行結果を踏まえた戦略・プロセス改善

## エラーハンドリング/リトライ
- **分析失敗**: Databricks API障害時は一時的な代替分析（簡易版）で継続、復旧後に完全分析
- **承認タイムアウト**: 7日間未承認の場合、自動でリマインダー送信・エスカレーション
- **計画実行エラー**: 個別タスク失敗時は依存関係を分析し、影響範囲を最小化
- **データ不整合**: Redmine-Databricks間のデータ同期エラー時は手動確認フローに移行

## 設定と秘密情報
- **環境変数**: 
  - `DATABRICKS_WORKSPACE_URL`: Databricksワークスペース接続先
  - `REDMINE_API_ENDPOINT`: Redmine API エンドポイント
  - `VSCODE_WORKSPACE_PATH`: 共同編集用ワークスペースパス
- **Secret管理**: 
  - Databricks Personal Access Token（Azure Key Vault）
  - Redmine API Key（Azure Key Vault）
  - GitHub Token（VS Code連携用）

## 監視/メトリクス
- **主要メトリクス**: 
  - 戦略分析処理時間（目標: <5分）
  - 承認フロー完了率（目標: >95%）
  - 計画実行成功率（目標: >80%）
  - 人機協調レビュー満足度（目標: >4.0/5.0）
- **ログ**: 
  - 戦略分析の全ステップ・決定根拠
  - 承認プロセスの詳細履歴
  - AI分析結果・人間判断の比較
- **トレース**: Redmine-Databricks-VS Code間の処理フロー全体を相関IDで追跡
